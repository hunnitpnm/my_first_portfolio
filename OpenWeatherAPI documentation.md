# Документация для [OpenWeatherAPI](https://openweathermap.org/)

>*Версия документации: 1.2*  
>*Последнее обновление: 31 января 2026*  
>*Автор: Новикова Елена*

Все примеры кода написаны на Python 3.12 с использованием библиотеки `requests`.

## Содержание
- [Быстрый старт](#быстрый-старт-quick-start)
- [Аутентификация](#аутентификация-и-получение-ключа-authentication)
- [Параметры вызова](#параметры-вызова-запроса-query-parameters)
- - [Указание местоположения](#указание-местоположения)
- - [Настраиваемые поля](#настраиваемые-поля-вызова)
- - [Единицы измерения](#единицы-измерения)
- - [Пример вызова API](#пример-вызова)
- [Ответы API](#ответы-resources)
- - [Ответ в формате JSON](#пример-ответа-api-в-формате-json)
- - [Ответ в формате XML](#пример-ответа-api-в-формате-xml)
- [Коды ответов API](#коды-ответов-api)
- [Советы по устранению неполадок](#советы-по-устранению-неполадок-troubleshooting)
- [Примеры практического использования](#примеры-использования-use-cases)
- - [Вывод определенных полей](#1-вывод-определенных-полей-с-конвертацией-времени-и-округлением-градусов)
- - [Расширенный анализ с рекомендациями](#2-расширенный-анализ-данных-с-рекомендациями)
- [Полезные ссылки](#полезные-ссылки-useful-links)

## Об API 

**OpenWeatherAPI** - API компании *OpenWeather Ltd*, который позволяет получать актуальные данные о погодных условиях в любой точке мира. К получению доступны прогнозы погоды от краткосрочных до годовых, а также исторические данные.

---

## Быстрый старт (Quick Start)
1. Получите API-ключ на [openweathermap.org](https://home.openweathermap.org/users/sign_up) (для России потребуется VPN)
2. Установите библиотеку requests: `pip install requests`
3. Используйте пример ниже:

```python
import requests

city = "Moscow"
country_code = "RU"   # Код страны (RU, US, GB и т.д.)
api_key = "API-КЛЮЧ"  # Получите на openweathermap.org

url = f"http://api.openweathermap.org/data/2.5/weather?q={city},{country_code}&appid={api_key}&units=metric&lang=ru"
response = requests.get(url)   # Отправка GET-запроса

if response.status_code == 200:   # проверка на корректность запроса
    data = response.json()
    if str(data.get("cod")) == "200":
        print(f"Погода в городе {data['name']}: {data['weather'][0]['description']}")
        print(f"Температура: {data['main']['temp']}°C")
    else:
        print(f"Ошибка API: {data.get('message')}")
else:
    print(f"HTTP ошибка: {response.status_code}")
```

Вывод:

```python
Погода в городе Москва: облачно с прояснениями
Температура: -19.84°C  # Температура по умолчанию представляется в Кельвинах, более подробно см. ниже

```

---

## Аутентификация и получение ключа (Authentication)

Для получения ключа сделайте следующее:

1. Зарегистрируйтесь на сайте [openweathermap.org](https://home.openweathermap.org/users/sign_up)
2. Подтвердите email
3. Создайте новый ключ на странице [API Keys](https://home.openweathermap.org/api_keys)
4. Подождите 10-15 минут активации ключа

При бесплатном тарифе использования можно создать неограниченное количество ключей. Нагрузка суммируется по всем сгенерированным ключам. 

**Лимит** - 60 запросов в минуту, 1 млн запросов в месяц. Полный прайс-лист предоставлен по [ссылке](https://openweathermap.org/full-price).

![Создание ключа](https://github.com/hunnitpnm/my_first_portfolio/blob/main/additional_materials/OpenWeatherAPI/api%20keys%201.jpg)


## Параметры вызова запроса (Query Parameters)

### Указание местоположения

**OpenWeatherAPI** дает возможность указать населенный пункт четырьмя способами:

1. Использовать географические координаты (широта и долгота)
2. Использовать название населенного пунктаили сочетание названия населенного пункта, кода страны. Для США дополнительно можно указать код штата
3. Использовать идентификатор населенного пункта. Для этого используется [стандарт ISO 3166](https://www.iso.org/obp/ui/#search)
4. Использовать почтовый индекс (только для США)

В рамках одного вызова необходимо использовать только **один** из доступных способов.

| Поле | Описание | Особенности | Пример |
|------|----------|-------------|-------|
| `q` | Название населенного пункта | Используется только название населенного пункта или сочетание названия населенного пункта, кода страны и код штата для США. Перечисление идет через запятую | `q=Prague,CZ` |
| `lat`, `lon` | Широта и долгота | Работает устаревший встроенный геокодер, доступный к использованию, но наблюдаться технические ошибки. При необходимости преобразования координат можно воспользоваться [API геокодирования](https://openweathermap.org/api/geocoding-api?collection=other)| `lat=51.512375&lon=-0.137598` |
| `id` | Идентификатор населенного пункта | Список идентификаторов городов доступен к скачиванию по [ссылке](https://bulk.openweathermap.org/sample/), выбрав "city.list.json.gz"| `id=2673730` |
| `zip` | Почтовый индекс | Используется только для городов США | `zip=03257` |

### Настраиваемые поля вызова

| Поле | Статус | Описание | Особенности | Пример |
|------|--------|----------|--------|-------|
| `appid`| Обязательный   | Уникальный API-ключ | Можно скопировать уже существующий API-ключ или создать новый в разделе [My API keys](https://home.openweathermap.org/api_keys)| `appid=123djp45...` |
| `mode` | Необязательный | Формат ответа | Возможные значения: `json`, `xml`, `html`. Формат по умолчанию: **json** | `mode=xml` |
| `units`| Необязательный | Единицы измерения | Возможные значения: `standard` - метеорологическая система, `metric` - метрическая система и `imperial` - имперская система (подробнее см. ниже) | `units=metric` |
| `lang` | Необязательный | Язык вывода | Перевод применяется к полям `city name` и `description`. Доступно 49 языков. Список всех значений доступен по [ссылке](https://openweathermap.org/current#multi). Язык по умолчанию: английский | `lang=ru` |

### Единицы измерения

> 1 градус по Кельвину = 273,15 градуса по Цельсию.

| Параметр | `standard` | `metric` | `imperial` |
|------|----------|----------|--------|
| Температура    | Кельвины (K)        | Цельсий (°C)        | Фаренгейт (°F)   |
| Давление       | гектопаскали (гПа)  | гектопаскали (гПа)  | миллибары (мбар) |
| Скорость ветра | метры/секунду (м/с) | метры/секунду (м/с) | мили/час (mph)   |
| Осадки         | миллиметры (мм)     | миллиметры (мм)     | дюймы (in)       |

---

### Пример вызова:

```python
lat = 51.51    # широта
lon = -0.13    # долгота
api_key = "ВАШ_API_КЛЮЧ"  # Получите на openweathermap.org
units = 'metric'
lang = 'ru'
url = f"https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={api_key}&units={units}&lang={lang}"
```

Разбор вызова

![разбор вызова](https://github.com/hunnitpnm/my_first_portfolio/blob/main/additional_materials/OpenWeatherAPI/%D1%80%D0%B0%D0%B7%D0%B1%D0%BE%D1%80%20%D0%B2%D1%8B%D0%B7%D0%BE%D0%B2%D0%B0.png)


---

## Ответы (Resources)

Формат выходных данных: **JSON** и **XML**. По умолчанию используется формат **JSON**. Для получения данных в формате **XML**, установите параметр `mode=xml` в запросе (блок XML доступен по [ссылке](#пример-ответа-api-в-формате-xml)).

***Важно***: в ответе API может отсутствовать часть параметров, если те или иные погодные явления не наблюдались в выбранном городе или местоположении в момент измерения. В ответе API отображаются только фактически измеренные или рассчитанные данные.

### Пример ответа API в формате JSON

Ответ содержит несколько логических блоков:

#### Блоки данных

| Поле | Тип | Описание | Пример |
|------|-----|----------|--------|
| `coord`   | object | [Геокоординаты](#1-геокоординаты-coord)| `{"lon": 37.62, "lat": 55.75}`                 |
| `weather` | array  | [Погодные условия](#2-погодные-условия-weather)| `[{"id": 800, "main": "Clear", ...}]`          |
| `main`    | object | [Метеорологические данные](#3-метеорологические-данные-main)| `{'temp': 276.52, 'feels_like': 272.64, ....}` |
| `wind`    | object | [Данные о ветре](#4-данные-о-ветре-wind)| `{'speed': 4.63, 'deg': 90, ...}`              |
| `base`    | string | [Источник данных](#5-источник-данных-base)|  `"stations"`                                  |
| `sys`     | object | [Системная информация](#6-системная-информация-sys)|  `{'type': 2, 'id': 2010430, ...`              |

#### 1. Геокоординаты (`coord`)

| Поле | Тип | Описание | 
|------|-----|----------|
| `lon` | float | Долгота |
| `lat` | float | Широта  |

#### 2. Погодные условия (`weather`)

| Поле | Тип | Описание | 
|------|-----|----------|
| `weather.id`          | integer | Идентификатор погодных условий |
| `weather.main`        | string  | Группа погодных условий        |
| `weather.description` | string  | Кокретный тип погоды           |
| `weather.icon`        | string  | Идентификатор значка погоды    |

#### 3. Метеорологические данные (`main`)

| Поле | Тип | Описание | Единицы изменения |
|------|-----|----------|-------|
| `main.temp`       | float   | Температура                               | Кельвины     |
| `main.feels_like` | float   | Ощущаемая температура                     | Кельвины     |
| `main.temp_min`   | float   | Минимальная температура в ближайший период (актуально для прогнозов) | Кельвины     |
| `main.temp_max`   | float   | Максимальная температура в ближайший период (актуально для прогнозов) | Кельвины     |
| `main.pressure`   | integer | Атмосферное давление на уровне моря       | гПа          |
| `main.humidity`   | integer | Влажность                                 | Проценты (%) |
| `main.sea_level`  | integer | Атмосферное давление на уровне моря       | гПа          |
| `main.grnd_level` | integer | Атмосферное давление на уровне земли      | гПа          |

#### 4. Данные о ветре (`wind`)

| Поле | Тип | Описание | Единицы изменения |
|------|-----|----------|-------|
| `wind.speed` | float   | Скорость ветра    | м/с          |
| `wind.deg`   | integer | Направление ветра | Метеоградусы |
| `wind.gust`  | float   | Порыв ветра       | м/с          |

#### 5. Источник данных (`base`)

| Поле | Значение |
|------|----------|
| `stations` | Данные с наземных метеостанций                 |
| `cities`   | Данные из городских сетей                      |
| `model`    | Прогностическая модель                         |
| `cmc`      | Canadian Meteorological Centre                 |
| `madis`    | Meteorological Assimilation Data Ingest System |

#### 6. Системная информация (`sys`)

| Поле | Описание | Пример |
|------|----------|--------|
| `sys.country` | Код страны (ISO 3166)   | `"RU"`       | 
| `sys.sunrise` | Восход (Unix timestamp) | `1769323538` | 
| `sys.sunset`  | Закат (Unix timestamp)  | `1769355795` | 

#### 7. Дополнительные данные

| Поле | Тип | Описание |
|------|-----|----------|
| `visibility` | integer         | Видимость в метрах                   |
| `clouds.all` | integer         | Облачность в процентах               |
| `rain.1h`    | float           | Количество осадков (дождь) в мм/ч    |
| `snow.1h`    | float           | Количество осадков (снег) в мм/ч     |
| `dt`         | integer         | Время вычисления данных (Unix, UTC)  |
| `timezone`   | integer         | Изменение времени по UTC в секундах  |
| `id`         | integer         | Идентификатор города                 |
| `name`       | string          | Название города                      |
| `cod`        | string, integer | Внутренний код результа (см. ниже)   |

#### 8. Внутренний код (`cod`)

Поле `cod` в теле ответа дублирует статус на уровне API:

| Значение | Когда возвращается | Особенность |
|----------|-------------------|-------------|
| `200`   | Успешный запрос | Всегда число               |
| `"404"` | Город не найден | При ошибке формат - строка |
| `"429"` | Лимит запросов  | При ошибке формат - строка |

> При необходимости рекомендуется сравнивать как строку или использовать `str(cod) != "200"`, а также всегда проверять оба кода, так как могут возникать ситуации, когда код HTTP и внутренний код не совпадают. Более подробная информация [ниже](#коды-ответов-api).

----

#### Пример ответа в формате ***JSON***:

```python
{
  'coord': {                  # геокоординаты
    'lon': 14.4208,   
    'lat': 50.088    
  },
  'weather': [                # погодные условия
    {
      'id': 701,   
      'main': 'Mist',
      'description': 'mist',
      'icon': '50n'
    },
  ],
  'base': 'stations',   # В данном примере значение 'stations' указывает на источник данных (наземные метеостанции)
  'main': {                   # метеорологические данные
    'temp': 276.13,
    'feels_like': 272.52,
    'temp_min': 274.8,
    'temp_max': 276.9,
    'pressure': 997,
    'humidity': 94,
    'sea_level': 997,
    'grnd_level': 962
  },
  'visibility': 5000,
  'wind': {                  #  данные о ветре 
    'speed': 4.02,
    'deg': 80
  },
  'rain': {
    '1h': 0.12
  },
  'clouds': {
    'all': 100
  },
  'dt': 1769365269,
  'sys': {                     # системная информация
    'type': 2,
    'id': 2010430,
    'country': 'CZ',
    'sunrise': 1769323538,
    'sunset': 1769355795
  },
  'timezone': 3600,
  'id': 3067696,
  'name': 'Prague',
  'cod': 200                  # поле внутреннего результата
}

```

---

### Пример ответа API в формате XML

Ответ содержит несколько логических блоков:

#### Блоки данных

| Поле | Описание | Пример |
|------|----------|--------|
| `city`       | Данные о местоположении  | `<city id="3163858" name="Zocca"...>` |
| `temperature`| Метеорологические данные |  `<temperature value="298.48"...`     |
| `wind`       | Данные о ветре           | `<speed value="0.62"`                 |
| `weather `   | Погодные условия         |  `<weather number="501"`              |

Названия и значения параметров идентичны формату [**JSON**](#пример-ответа-api-в-формате-json).

### Пример ответа в формате ***XML***

```xml
<current>
    <city id="3076793" name="Dolní Liboc">                                    # Данные о местоположении
        <coord lat="50.1" lon="14.3"/>
        <country>CZ</country>
        <timezone>3600</timezone>
        <sun rise="2026-01-30T06:39:49" set="2026-01-30T15:52:08"/>
    </city>
    <temperature max="272.68" min="271.18" unit="kelvin" value="272.05"/>     # Метеорологические данные
    <feels_like unit="kelvin" value="267.83"/>
    <humidity unit="%" value="96"/>
    <pressure unit="hPa" value="1006"/>
    <wind>                                                                   # Данные о ветре
        <speed name="Gentle Breeze" unit="m/s" value="3.58"/>
        <gusts/>
        <direction code="ENE" name="East-northeast" value="70"/>
    </wind>
    <clouds name="overcast clouds" value="100"/>                             
    <visibility value="2800"/>
    <precipitation mode="no"/>
    <weather icon="50n" number="701" value="mist"/>                           # Погодные условия
    <lastupdate value="2026-01-30T22:17:16"/>           
</current>
```

---

## Коды ответов API

*OpenWeatherAPI* использует **двухуровневую систему кодов**, поэтому необходимо проверять оба кода.

| HTTP-статус | Значение `cod` | Возможная причина | Пример |
|-----------|------------|--------------|--------------|
| `200` | `200` | Успешное выполнение запроса                                    | Полные данные о погоде                             |
| `400` |`"400"`| Неверные параметры запроса (ошибка в синтаксисе или параметрах)| `{"cod":"400", "message":"...bad request..."}`     |
| `401` |`"401"`| Неверный, неактивированный или отсутствующий API-ключ          | `{"cod":"401", "message":"Invalid API key..."}`    |
| `404` |`"404"`| Указанный город или местоположение не найдено                  | `{"cod":"404", "message":"city not found"}`        |
| `405` |`"405"`| Неверный тип запроса (любой кроме GET)                         | `{"cod":"405","message":"Internal error"}`         |
| `429` |`"429"`| Превышен лимит запросов (60/мин для бесплатного тарифа)        | `{"cod":"429", "message":"...rate limit..."}`      |
| `5xx` |`"5xx"`| Внутренняя ошибка сервера *OpenWeather*                        | `{"cod":"500", "message":"Internal server error"}` |

>***Важно***: полный исчерпывающий список всех возможных HTTP-ошибок не предоставляется официально. В таблице выше собраны наиболее частые коды, с которыми сталкиваются разработчики. Список сформирован на основе анализа документации и практического опыта работы с API

Код для проверки обоих кодов:

```python
if response.status_code == 200:
    data = response.json()
    if str(data.get("cod")) == "200":  # Проверка внутреннего кода API через сравнивание строк
        print("Успешная проверка")
    else:
        print(f"Ошибка API: {data.get('message')}")
else:
    print(f"HTTP ошибка: {response.status_code}")
```

---

### Советы по устранению неполадок (Troubleshooting)

| HTTP-статус | Как исправить |
|----------|---------------|
| `409` | Проверить кореектность запроса, синтаксис и параметры |
| `401` | Проверить ключ, подождать 10-15 минут после создания |
| `404` | Проверить правильность названия города, кода страны или city_id |
| `405` | Проверить тип запроса, API принимает только GET-запросы |
| `429` | Реализовать задержки между запросами (например, time.sleep(2)) |
| `5xx` | Серверная ошибка, повторить запрос позже |

---

## Примеры использования (Use Cases)

### 1. Вывод определенных полей с конвертацией времени и округлением градусов

```python
import requests
import time

city = "Prague"
country_code = "CZ"  # Код страны (RU, US, GB и т.д.)

api_key = 'Ваш API-ключ'
url = f"http://api.openweathermap.org/data/2.5/weather?q={city},{country_code}&appid={api_key}&units=metric&lang=ru"
response = requests.get(url)   # Отправка GET-запроса
data = response.json()
local_time = time.strftime("%d %b %Y", time.localtime(data['dt']))  # конвертация времени до даты
daylight_hours = (data["sys"]["sunset"] - data["sys"]["sunrise"]) / 3600  # вычисление длины светового дня

print(f"Погода в городе {data['name']} на {local_time}:")
print(f"Температура: {int(data['main']['temp'])}°C, {data['weather'][0]['description']}")
print(f"Световой день: {daylight_hours:.1f} часов")
```

Вывод:

```python
Погода в городе Прага на 31 Jan 2026:
Температура: 0°C, туман
Световой день: 9.3 часов
```

### 2. Расширенный анализ данных с рекомендациями

```python
import requests

city = "Moscow"
country = "RU"
api_key = 'Ваш API-ключ'

def weather_analysis(city, country):
    data = requests.get(
        f"http://api.openweathermap.org/data/2.5/weather?q={city},{country}&appid={api_key}&units=metric&lang=ru").json()
    weather_id = data['weather'][0]['id']
    temp = data['main']['temp']
    wind = data['wind']['speed']
    feels_like = data['main']['feels_like']
    advice = []

    # Анализ типа погоды
    if 200 <= weather_id <= 232:
        advice.append('Гроза. Лучше остаться дома.')
    elif 300 <= weather_id <= 600:
        advice.append('Осадки. Возьмите зонт и будьте осторожны.')
    elif 600 <= weather_id <= 622:
        advice.append('Снег. Одевайтесь теплее, будьте осторожны на дорогах.')
    elif 700 <= weather_id <= 781:
        advice.append('Атмосферные явления. Будьте внимательны, видимость снижена.')

    # Анализ температуры
    if int(temp) < 0:
        advice.append(f'На улице холодно. Оденьтесь тепло и не забудьте про шапку. Температура: {int(temp)}. Ощущается как: {int(feels_like)}.')
    elif 0 <= int(temp) <= 10:
        advice.append(f'На улице прохладно, оденьтесь теплее. Температура: {int(temp)}. Ощущается как: {int(feels_like)}.')
    elif int(temp) > 30:
        advice.append(f"Жарко. Пейте достаточно воды и избегайте солнца в пиковые часы. Температура: {int(temp)}. Ощущается как: {int(feels_like)}.")

    # Анализ ветра
    if wind > 10:
        advice.append("Сильный ветер, оденьтесь теплее.")
    elif wind > 5:
        advice.append("Ветрено.")

    if not advice:  # Если советов нет
        advice.append("Идеальная погода для прогулки!")

    return advice

advices = weather_analysis(city, country)
print(*advices, sep='\n')
```

Вывод:

```
На улице холодно. Оденьтесь тепло и не забудьте про шапку. Температура: -19. Ощущается как: -26.
Ветрено.
```

---

## Полезные ссылки (Useful links)

* [Официальный сайт](https://openweathermap.org/)
* [Официальная документация](https://openweathermap.org/current?collection=current_forecast)
* [Полный перечень кодов погодных условий](https://openweathermap.org/weather-conditions?collection=other)
* [Раздел "My API keys"](https://home.openweathermap.org/api_keys)
* [API геокодирования](https://openweathermap.org/api/geocoding-api?collection=other)
* [Список идентификаторов городов](https://bulk.openweathermap.org/sample/)
* [ISO 3166](https://www.iso.org/obp/ui/#search)
* [Список доступных языков](https://openweathermap.org/current?collection=current_forecast&collection=current_forecast&collection=current_forecast#multi)
* [Тарифы](https://openweathermap.org/price)
